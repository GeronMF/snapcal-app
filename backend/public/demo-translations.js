const demoTranslations = {
    ru: {
        'demo.title': 'üß™ SlimIQ Demo',
        'demo.description': '–ü–æ–ø—Ä–æ–±—É–π—Ç–µ AI –∞–Ω–∞–ª–∏–∑ –∫–∞–ª–æ—Ä–∏–π–Ω–æ—Å—Ç–∏ –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å',
        'back': '‚Üê –ù–∞–∑–∞–¥ –∫ –≥–ª–∞–≤–Ω–æ–π',
        'upload.title': '–ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–æ—Ç–æ –µ–¥—ã',
        'upload.description': '–ù–∞–∂–º–∏—Ç–µ –∏–ª–∏ –ø–µ—Ä–µ—Ç–∞—â–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å—é–¥–∞',
        'analyze': 'ü§ñ –ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å AI',
        'reset': 'üîÑ –í—ã–±—Ä–∞—Ç—å –¥—Ä—É–≥–æ–µ —Ñ–æ—Ç–æ',
        'loading.title': '–ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ...',
        'loading.description': 'AI –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –∫–∞–ª–æ—Ä–∏–∏ –∏ –ø–∏—Ç–∞—Ç–µ–ª—å–Ω—ã–µ –≤–µ—â–µ—Å—Ç–≤–∞',
        'result.title': 'üìä –†–µ–∑—É–ª—å—Ç–∞—Ç –∞–Ω–∞–ª–∏–∑–∞',
        'hero.subtitle': '–°–¥–µ–ª–∞–π—Ç–µ —Ñ–æ—Ç–æ –µ–¥—ã –∏ –ø–æ–ª—É—á–∏—Ç–µ –∞–Ω–∞–ª–∏–∑ –∫–∞–ª–æ—Ä–∏–π–Ω–æ—Å—Ç–∏'
    },
    en: {
        'demo.title': 'üß™ SlimIQ Demo',
        'demo.description': 'Try AI calorie analysis right now',
        'back': '‚Üê Back to Home',
        'upload.title': 'Upload Food Photo',
        'upload.description': 'Click or drag an image here',
        'analyze': 'ü§ñ Analyze with AI',
        'reset': 'üîÑ Choose Another Photo',
        'loading.title': 'Analyzing image...',
        'loading.description': 'AI is determining calories and nutrients',
        'result.title': 'üìä Analysis Result',
        'hero.subtitle': 'Take a photo of your food and get a calorie analysis'
    },
    uk: {
        'demo.title': 'üß™ SlimIQ Demo',
        'demo.description': '–°–ø—Ä–æ–±—É–π—Ç–µ AI –∞–Ω–∞–ª—ñ–∑ –∫–∞–ª–æ—Ä—ñ–π–Ω–æ—Å—Ç—ñ –ø—Ä—è–º–æ –∑–∞—Ä–∞–∑',
        'back': '‚Üê –ù–∞–∑–∞–¥ –¥–æ –≥–æ–ª–æ–≤–Ω–æ—ó',
        'upload.title': '–ó–∞–≤–∞–Ω—Ç–∞–∂—Ç–µ —Ñ–æ—Ç–æ —ó–∂—ñ',
        'upload.description': '–ù–∞—Ç–∏—Å–Ω—ñ—Ç—å –∞–±–æ –ø–µ—Ä–µ—Ç—è–≥–Ω—ñ—Ç—å –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è —Å—é–¥–∏',
        'analyze': 'ü§ñ –ê–Ω–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –∑ AI',
        'reset': 'üîÑ –í–∏–±—Ä–∞—Ç–∏ —ñ–Ω—à–µ —Ñ–æ—Ç–æ',
        'loading.title': '–ê–Ω–∞–ª—ñ–∑—É—î–º–æ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è...',
        'loading.description': 'AI –≤–∏–∑–Ω–∞—á–∞—î –∫–∞–ª–æ—Ä—ñ–π–Ω—ñ—Å—Ç—å —Ç–∞ –ø–æ–∂–∏–≤–Ω—ñ —Ä–µ—á–æ–≤–∏–Ω–∏',
        'result.title': 'üìä –†–µ–∑—É–ª—å—Ç–∞—Ç –∞–Ω–∞–ª—ñ–∑—É',
        'hero.subtitle': '–ó—Ä–æ–±—ñ—Ç—å —Ñ–æ—Ç–æ —ó–∂—ñ —ñ –æ—Ç—Ä–∏–º–∞–π—Ç–µ –∞–Ω–∞–ª—ñ–∑ –∫–∞–ª–æ—Ä—ñ–π–Ω–æ—Å—Ç—ñ'
    },
    pl: {
        'demo.title': 'üß™ SlimIQ Demo',
        'demo.description': 'Wypr√≥buj analizƒô kalorii AI ju≈º teraz',
        'back': '‚Üê Powr√≥t do strony g≈Ç√≥wnej',
        'upload.title': 'Prze≈õlij zdjƒôcie jedzenia',
        'upload.description': 'Kliknij lub przeciƒÖgnij obraz tutaj',
        'analyze': 'ü§ñ Analizuj z AI',
        'reset': 'üîÑ Wybierz inne zdjƒôcie',
        'loading.title': 'Analizowanie obrazu...',
        'loading.description': 'AI okre≈õla kalorie i sk≈Çadniki od≈ºywcze',
        'result.title': 'üìä Wynik analizy',
        'hero.subtitle': 'Wykonaj zdjƒôcie jedzenia i uzyskaj analizƒô kalorii'
    },
    es: {
        'demo.title': 'üß™ SlimIQ Demo',
        'demo.description': 'Prueba el an√°lisis de calor√≠as con IA ahora mismo',
        'back': '‚Üê Volver al inicio',
        'upload.title': 'Subir foto de comida',
        'upload.description': 'Haz clic o arrastra una imagen aqu√≠',
        'analyze': 'ü§ñ Analizar con IA',
        'reset': 'üîÑ Elegir otra foto',
        'loading.title': 'Analizando imagen...',
        'loading.description': 'La IA est√° determinando calor√≠as y nutrientes',
        'result.title': 'üìä Resultado del an√°lisis',
        'hero.subtitle': 'Toma una foto de tu comida y obt√©n un an√°lisis de calor√≠as'
    }
};

let currentLang = 'ru';

function changeLanguage() {
    const select = document.getElementById('languageSelect');
    currentLang = select.value;
    
    document.documentElement.lang = currentLang;
    document.documentElement.setAttribute('data-lang', currentLang);
    
    updateTranslations();
    localStorage.setItem('snapcal-lang', currentLang);
}

function updateTranslations() {
    const elements = document.querySelectorAll('[data-translate]');
    elements.forEach(element => {
        const key = element.getAttribute('data-translate');
        if (demoTranslations[currentLang] && demoTranslations[currentLang][key]) {
            element.textContent = demoTranslations[currentLang][key];
        }
    });
}



// –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –¥–µ–º–æ
let selectedFile = null;

// –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤
document.addEventListener('DOMContentLoaded', function() {
    const savedLang = localStorage.getItem('snapcal-lang') || 'ru';
    currentLang = savedLang;
    const languageSelect = document.getElementById('languageSelect');
    languageSelect.value = savedLang;
    languageSelect.addEventListener('change', changeLanguage);
    changeLanguage();
    
    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤
    document.getElementById('fileInput').addEventListener('change', handleFileSelect);
    
    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫
    document.getElementById('analyzeBtn').addEventListener('click', analyzeImage);
    document.getElementById('resetBtn').addEventListener('click', resetDemo);
    
    const uploadArea = document.getElementById('uploadArea');
    uploadArea.addEventListener('click', () => {
        document.getElementById('fileInput').click();
    });
    
    uploadArea.addEventListener('dragover', (e) => {
        e.preventDefault();
        uploadArea.classList.add('dragover');
    });
    
    uploadArea.addEventListener('dragleave', () => {
        uploadArea.classList.remove('dragover');
    });
    
    uploadArea.addEventListener('drop', (e) => {
        e.preventDefault();
        uploadArea.classList.remove('dragover');
        const files = e.dataTransfer.files;
        if (files.length > 0) {
            handleFile(files[0]);
        }
    });
});

function handleFileSelect(e) {
    const file = e.target.files[0];
    if (file) {
        handleFile(file);
    }
}

function handleFile(file) {
    if (!file.type.startsWith('image/')) {
        alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ');
        return;
    }
    
    selectedFile = file;
    const reader = new FileReader();
    reader.onload = (e) => {
        document.getElementById('previewImage').src = e.target.result;
        document.getElementById('previewSection').style.display = 'block';
        document.getElementById('uploadArea').style.display = 'none';
    };
    reader.readAsDataURL(file);
}

function resetDemo() {
    selectedFile = null;
    document.getElementById('previewSection').style.display = 'none';
    document.getElementById('resultSection').style.display = 'none';
    document.getElementById('loadingSection').style.display = 'none';
    document.getElementById('uploadArea').style.display = 'block';
    document.getElementById('fileInput').value = '';
}

async function analyzeImage() {
    if (!selectedFile) return;
    
    document.getElementById('loadingSection').style.display = 'block';
    document.getElementById('resultSection').style.display = 'none';
    
    const formData = new FormData();
    formData.append('image', selectedFile);
    formData.append('language', currentLang);
    
    try {
        const response = await fetch('/api/ai/analyze', {
            method: 'POST',
            body: formData,
            signal: AbortSignal.timeout(120000) // 2 –º–∏–Ω—É—Ç—ã —Ç–∞–π–º–∞—É—Ç
        });
        
        const result = await response.json();
        
        document.getElementById('loadingSection').style.display = 'none';
        
        if (result.success) {
            displayResult(result.data);
        } else {
            alert('–û—à–∏–±–∫–∞ –∞–Ω–∞–ª–∏–∑–∞: ' + result.error);
        }
    } catch (error) {
        document.getElementById('loadingSection').style.display = 'none';
        alert('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ' + error.message);
    }
}

function displayResult(data) {
    const resultContent = document.getElementById('resultContent');
    resultContent.innerHTML = `
        <h4>${data.food_name || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ–µ –±–ª—é–¥–æ'}</h4>
        <div class="nutrition-grid">
            <div class="nutrition-item">
                <div class="nutrition-value">${Math.round(data.calories || 0)}</div>
                <div>–ö–∞–ª–æ—Ä–∏–∏</div>
            </div>
            <div class="nutrition-item">
                <div class="nutrition-value">${Math.round(data.protein || 0)}–≥</div>
                <div>–ë–µ–ª–∫–∏</div>
            </div>
            <div class="nutrition-item">
                <div class="nutrition-value">${Math.round(data.carbs || 0)}–≥</div>
                <div>–£–≥–ª–µ–≤–æ–¥—ã</div>
            </div>
            <div class="nutrition-item">
                <div class="nutrition-value">${Math.round(data.fat || 0)}–≥</div>
                <div>–ñ–∏—Ä—ã</div>
            </div>
        </div>
        <p><strong>–£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å AI:</strong> ${Math.round(data.confidence || 0)}%</p>
        <p><em>–≠—Ç–æ –¥–µ–º–æ-–≤–µ—Ä—Å–∏—è. –î–ª—è –ø–æ–ª–Ω–æ–≥–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞ —Å–∫–∞—á–∞–π—Ç–µ –º–æ–±–∏–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ!</em></p>
    `;
    
    document.getElementById('resultSection').style.display = 'block';
} 