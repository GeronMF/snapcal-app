# –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π AI –∞–Ω–∞–ª–∏–∑–∞

## –ü—Ä–æ–±–ª–µ–º–∞

AI –∞–Ω–∞–ª–∏–∑ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω–æ:

- GIF –∞–Ω–∏–º–∞—Ü–∏—è –Ω–µ –≤—Å–µ–≥–¥–∞ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ
- –¢–∞–π–º–∞—É—Ç—ã –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ OpenAI API
- –ù–µ–∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–∞—è —Ä–∞–±–æ—Ç–∞ –ø–æ—Å–ª–µ –ø–µ—Ä–µ–ª–æ–≥–∏–Ω–æ–≤

## –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 1. Frontend –∏–∑–º–µ–Ω–µ–Ω–∏—è (React Native)

**–§–∞–π–ª: `frontend/components/AILoadingModal.tsx`**

- ‚úÖ –£–ª—É—á—à–µ–Ω–∞ –ø—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫–∞ GIF –∞–Ω–∏–º–∞—Ü–∏–∏
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω fallback –¥–ª—è —Å–ª—É—á–∞–µ–≤ –æ—à–∏–±–∫–∏ –∑–∞–≥—Ä—É–∑–∫–∏ GIF
- ‚úÖ –ì–ª–æ–±–∞–ª—å–Ω–∞—è –ø—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –º–æ–¥—É–ª—è

**–§–∞–π–ª: `frontend/utils/api.ts`**

- ‚úÖ –£–≤–µ–ª–∏—á–µ–Ω —Ç–∞–π–º–∞—É—Ç –¥–æ 120 —Å–µ–∫—É–Ω–¥ (–±—ã–ª–æ 90)
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω retry –º–µ—Ö–∞–Ω–∏–∑–º (2 –ø–æ–ø—ã—Ç–∫–∏ —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π 2 —Å–µ–∫)
- ‚úÖ –£–ª—É—á—à–µ–Ω–∞ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –æ—à–∏–±–æ–∫ —Å–µ—Ç–∏ –∏ —Ç–∞–π–º–∞—É—Ç–æ–≤

### 2. Backend –∏–∑–º–µ–Ω–µ–Ω–∏—è (Node.js)

**–§–∞–π–ª: `backend/src/services/aiAnalysisService.js`**

- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ –¥–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å —É–Ω–∏–∫–∞–ª—å–Ω—ã–º–∏ ID –∑–∞–ø—Ä–æ—Å–æ–≤
- ‚úÖ –£–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ OpenAI API
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤—Ä–µ–º–µ–Ω–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —ç—Ç–∞–ø–æ–≤

**–§–∞–π–ª: `backend/src/routes/ai.js`**

- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω middleware –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤
- ‚úÖ –£–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ç–∏–ø–æ–≤ –æ—à–∏–±–æ–∫
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã –∫–æ–¥—ã –æ—à–∏–±–æ–∫ –¥–ª—è frontend

**–ù–æ–≤—ã–µ —Ñ–∞–π–ª—ã:**

- ‚úÖ `backend/src/middleware/requestLogger.js` - –¥–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- ‚úÖ `backend/src/config/aiConfig.js` - —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
- ‚úÖ `backend/diagnostic-ai.js` - –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏

## –§–∞–π–ª—ã –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–Ω —Å–µ—Ä–≤–µ—Ä

### –ù–∞ —Å–µ—Ä–≤–µ—Ä snapcal.fun –≤ –ø–∞–ø–∫—É `/home/snapcalfun/www/backend/`:

1. **–û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã backend:**

   ```
   src/services/aiAnalysisService.js
   src/routes/ai.js
   src/middleware/requestLogger.js
   src/config/aiConfig.js
   diagnostic-ai.js
   ```

2. **–ö–æ–º–∞–Ω–¥—ã –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —á–µ—Ä–µ–∑ SSH:**

   ```bash
   # –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ä–≤–µ—Ä—É
   ssh snapcalfun@your-server -p 22

   # –ü–µ—Ä–µ—Ö–æ–¥ –≤ –ø–∞–ø–∫—É backend
   cd /home/snapcalfun/www/backend

   # –°–æ–∑–¥–∞–Ω–∏–µ —Ä–µ–∑–µ—Ä–≤–Ω—ã—Ö –∫–æ–ø–∏–π
   cp src/services/aiAnalysisService.js src/services/aiAnalysisService.js.backup
   cp src/routes/ai.js src/routes/ai.js.backup

   # –ó–∞–≥—Ä—É–∑–∫–∞ –Ω–æ–≤—ã—Ö —Ñ–∞–π–ª–æ–≤ (—á–µ—Ä–µ–∑ scp –∏–ª–∏ –¥—Ä—É–≥–æ–π —Å–ø–æ—Å–æ–±)
   # scp local-path/file server:/home/snapcalfun/www/backend/path/
   ```

3. **–ü–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤:**

   ```bash
   # –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
   pm2 restart snapcal-backend

   # –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤
   pm2 logs snapcal-backend

   # –ó–∞–ø—É—Å–∫ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
   node diagnostic-ai.js
   ```

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø–æ—Å–ª–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è

### 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏:

```bash
# –û–±—â–∏–µ –ª–æ–≥–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
pm2 logs snapcal-backend

# –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ª–æ–≥–æ–≤ AI –∞–Ω–∞–ª–∏–∑–∞
pm2 logs snapcal-backend | grep "AI Analysis"

# –ü–æ–∏—Å–∫ –æ—à–∏–±–æ–∫ —Ç–∞–π–º–∞—É—Ç–∞
pm2 logs snapcal-backend | grep -i "timeout\|timed out"
```

### 2. –ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è:

- ‚úÖ –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è AI –∞–Ω–∞–ª–∏–∑–∞ (–¥–æ–ª–∂–Ω–æ –±—ã—Ç—å < 60 —Å–µ–∫)
- ‚úÖ –ß–∞—Å—Ç–æ—Ç–∞ –æ—à–∏–±–æ–∫ —Ç–∞–π–º–∞—É—Ç–∞ (–¥–æ–ª–∂–Ω–∞ —Å–Ω–∏–∑–∏—Ç—å—Å—è)
- ‚úÖ –£—Å–ø–µ—à–Ω–æ—Å—Ç—å –ø—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫–∏ GIF
- ‚úÖ –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ retry –ø–æ–ø—ã—Ç–æ–∫

### 3. –ß—Ç–æ –∏—Å–∫–∞—Ç—å –≤ –ª–æ–≥–∞—Ö:

```
üîç [requestId] - —É–Ω–∏–∫–∞–ª—å–Ω—ã–π ID –∑–∞–ø—Ä–æ—Å–∞ –¥–ª—è —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∏
‚è±Ô∏è [requestId] Total analysis time: Xms - –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
‚ùå [requestId] AI Analysis error - –æ—à–∏–±–∫–∏ –∞–Ω–∞–ª–∏–∑–∞
üîÑ [requestId] Using fallback - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ fallback
üì¶ [requestId] Returning cached result - –∫—ç—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
```

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ—Å–ª–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è

### 1. –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã:

- [ ] –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ—Ç–æ ‚Üí –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ GIF –∞–Ω–∏–º–∞—Ü–∏–∏
- [ ] –£—Å–ø–µ—à–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
- [ ] –ü–æ–≤—Ç–æ—Ä–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –±–µ–∑ –ø–µ—Ä–µ–ª–æ–≥–∏–Ω–∞
- [ ] –†–∞–±–æ—Ç–∞ –ø–æ—Å–ª–µ –ø–µ—Ä–µ–ª–æ–≥–∏–Ω–∞
- [ ] Fallback –ø—Ä–∏ —Ç–∞–π–º–∞—É—Ç–µ

### 2. –ù–∞–≥—Ä—É–∑–æ—á–Ω—ã–µ —Ç–µ—Å—Ç—ã:

- [ ] –ù–µ—Å–∫–æ–ª—å–∫–æ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- [ ] –ë–æ–ª—å—à–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (–±–ª–∏–∑–∫–æ –∫ –ª–∏–º–∏—Ç—É 10MB)
- [ ] –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –æ—Ç –æ–¥–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

## –û—Ç–∫–∞—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π (–µ—Å–ª–∏ –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è)

```bash
# –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ —Ä–µ–∑–µ—Ä–≤–Ω—ã—Ö –∫–æ–ø–∏–π
cd /home/snapcalfun/www/backend
cp src/services/aiAnalysisService.js.backup src/services/aiAnalysisService.js
cp src/routes/ai.js.backup src/routes/ai.js

# –£–¥–∞–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö —Ñ–∞–π–ª–æ–≤
rm src/middleware/requestLogger.js
rm src/config/aiConfig.js
rm diagnostic-ai.js

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫
pm2 restart snapcal-backend
```

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### 1. –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è (.env):

–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–æ–±–∞–≤–∏—Ç—å –≤ –ø—Ä–æ–¥–∞–∫—à–Ω .env —Ñ–∞–π–ª:

```
AI_CACHE_ENABLED=true
AI_FALLBACK_ENABLED=true
AI_MAX_TOKENS=500
LOG_LEVEL=info
```

### 2. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏:

- –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–ª–µ—Ä—Ç—ã –Ω–∞ –≤—ã—Å–æ–∫–æ–µ –≤—Ä–µ–º—è –æ—Ç–∫–ª–∏–∫–∞ (>30 —Å–µ–∫)
- –ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏
- –û—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å —á–∞—Å—Ç–æ—Ç—É –æ—à–∏–±–æ–∫

### 3. –ü–ª–∞–Ω—ã –Ω–∞ –±—É–¥—É—â–µ–µ:

- –î–æ–±–∞–≤–∏—Ç—å Redis –¥–ª—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
- –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫—É –Ω–∞–≥—Ä—É–∑–∫–∏ –¥–ª—è AI –∑–∞–ø—Ä–æ—Å–æ–≤
- –î–æ–±–∞–≤–∏—Ç—å health-check endpoints

---

**–í–∞–∂–Ω–æ:** –í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã –ª–æ–∫–∞–ª—å–Ω–æ –∏ –≥–æ—Ç–æ–≤—ã –∫ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é. Frontend –∏–∑–º–µ–Ω–µ–Ω–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥—Ö–≤–∞—Ç—è—Ç—Å—è –ø—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º –±–∏–ª–¥–µ –º–æ–±–∏–ª—å–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.
